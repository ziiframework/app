name: Zii-CI

on:
  push:
    branches: [ master ]

  pull_request:
    branches: [ master ]

jobs:
  fullstack:
    name: PHP 7.4 on Ubuntu 20.04
    if: "!contains(github.event.head_commit.message, 'skip ci')"
    runs-on: ubuntu-latest
    container: charescape/web:3.0.4
    steps:
      - uses: actions/checkout@v2

      - name: Composer Install
        run: |
          rm composer.lock
          /usr/local/php/bin/php /usr/local/bin/composer.phar install --prefer-dist --no-interaction --optimize-autoloader

      - name: Directory Setup
        run: |
          chmod -R 777 ./runtime
          chmod -R 644 ./runtime/.gitignore

      - name: Copy Directory
        run: |
          cp -r ../app /var/www/yiitest
          echo '---ls---' && ls /var/www/yiitest

      - name: Start Service
        run: |
          /etc/my_init.d/runapp.sh

      - name: Codeception
        run: /usr/local/php/bin/php vendor/bin/codecept run --steps
